ğŸ§¾ Lektionsplanering â€“ MÃ¥ndag 12 maj 2025
â° Tid: 09.00â€“12.00
ğŸ¯ Fokus: Ansluta Express-API till PostgreSQL med pg-modulen
ğŸ§  Pedagogiskt fokus: steg-fÃ¶r-steg genomgÃ¥ng av fullstÃ¤ndig integration â†’ lÃ¥t studenterna bygga vidare praktiskt

-----------------------------
ğŸ¯ Syfte

FÃ¶rstÃ¥ hur man kopplar ett Node.js/Express-API till en PostgreSQL-databas

Kunna lÃ¤sa, skriva, uppdatera och ta bort data frÃ¥n databasen via API-anrop (CRUD)

FÃ¥ praktisk erfarenhet av pg-modulen fÃ¶r databasanslutning

-----------------------------
ğŸ§  Agenda

09.00â€“09.15	ğŸ‘‹ Intro & teori	Vad Ã¤r pg-modulen? Hur fungerar anslutning till PostgreSQL frÃ¥n Express?
09.15â€“10.15	ğŸ’» Code-Along 1	Initiera Express-projekt, installera pg, skapa anslutning, GET/POST-rutter
10.15â€“10.25	â˜• Paus	
10.25â€“11.10	ğŸ’» Code-Along 2	Bygg vidare pÃ¥ PUT, DELETE, och felhantering
11.10â€“11.50	ğŸ§‘â€ğŸ’» SjÃ¤lvstÃ¤ndig Ã¶vning	Skapa eget API med minst tvÃ¥ entiteter, CRUD och PostgreSQL-koppling
11.50â€“12.00	ğŸ” Reflektion & frÃ¥gor	Kort diskussion i helklass: vad kÃ¤ndes svÃ¥rt? Hur hÃ¤nger allt ihop?

-----------------------------
ğŸ§  TEORI â€“ TALARMANUS

ğŸ—£ï¸ Vad Ã¤r pg?

"pg Ã¤r ett Node.js-paket som gÃ¶r det mÃ¶jligt att kommunicera med PostgreSQL direkt frÃ¥n vÃ¥r server. Vi kan t.ex. skicka SQL-frÃ¥gor frÃ¥n vÃ¥ra API-rutter."

ğŸ—£ï¸ Hur fungerar kopplingen?

"Vi skapar en client eller pool, kopplar mot databasens URL och anvÃ¤nder t.ex. client.query() fÃ¶r att kÃ¶ra SQL."

ğŸ—£ï¸ VarfÃ¶r bygga ett API ovanpÃ¥ databasen?

"FÃ¶r att frontend (t.ex. React) ska kunna prata med databasen mÃ¥ste vi bygga en mellanliggande server (API) som hanterar logiken."

-----------------------------
ğŸ“š Viktiga begrepp att fÃ¶rklara:

- **REST API** â€“ ett sÃ¤tt att strukturera endpoints fÃ¶r att hÃ¤mta/skicka data

- **pg (node-postgres)** â€“ modul fÃ¶r att skicka SQL-frÃ¥gor frÃ¥n Node.js

- **Pool vs. Client** â€“ Pool = Ã¥teranvÃ¤ndbara anslutningar, Client = enskild anslutning

- **Request Body** â€“ data som skickas med POST/PUT i t.ex. JSON

- **Statuskoder** â€“ t.ex. 200 OK, 201 Created, 404 Not Found, 500 Internal Server Error

- **REST API** â€“ ett sÃ¤tt att strukturera endpoints fÃ¶r att hÃ¤mta/skicka data
- **pg (node-postgres)** â€“ modul fÃ¶r att skicka SQL-frÃ¥gor frÃ¥n Node.js
- **Pool vs. Client** â€“ Pool = Ã¥teranvÃ¤ndbara anslutningar, Client = enskild anslutning
- **Request Body** â€“ data som skickas med POST/PUT i t.ex. JSON
- **Statuskoder** â€“ t.ex. 200 OK, 201 Created, 404 Not Found, 500 Internal Server Error

- Vad Ã¤r Prepared Statements och varfÃ¶r anvÃ¤nder vi $1, $2?
const result = await pool.query(`SELECT * FROM users WHERE name = '${userInput}'`);

...dÃ¥ kan en illvillig anvÃ¤ndare skriva nÃ¥got som:
' OR 1=1; --

Vilket ger:
SELECT * FROM users WHERE name = '' OR 1=1; --'

â¡ï¸ Det hÃ¤r returnerar alla anvÃ¤ndare och kan Ã¤ventyra sÃ¤kerheten.

âœ… LÃ¶sning: Prepared Statements
NÃ¤r vi istÃ¤llet skriver:
const result = await pool.query(
  "SELECT * FROM users WHERE name = $1",
  [userInput]
);

$1 Ã¤r en placeholder

[userInput] Ã¤r en vÃ¤rdelista

pg hanterar insÃ¤ttningen sÃ¤kert, automatiskt sanerat

â¡ï¸ Det skyddar mot SQL-injektion, eftersom frÃ¥gan kompileras innan data sÃ¤tts in.

-----------------------------
GrundlÃ¤ggande Ã¤mnen/keyword/syntax:

- `app.get()`, `app.post()`, `app.put()`, `app.delete()` â€“ REST-metoder i Express

- `req.params`, `req.body` â€“ data frÃ¥n URL respektive request body

- `pool.query()` â€“ skickar SQL-frÃ¥ga till databasen

- `await`/`async` â€“ hanterar asynkron kommunikation

- `try/catch` â€“ fÃ¥ngar och hanterar fel

- `RETURNING *` â€“ returnerar ny/uppdaterad rad frÃ¥n INSERT/UPDATE/DELETE

-----------------------------
-----------------------------
-----------------------------
ğŸ’» CODE-ALONG

Del 1: Setup & GET/POST

npm init -y
npm install express pg

Skapa index.js:

GenomfÃ¶r den koden.

-----------------------------
Del 2: PUT, DELETE & felhantering

fortsÃ¤tt i index.js:

GenomfÃ¶r den koden.

-----------------------------
-----------------------------
Del 3: Testa alla routes med Postman

ğŸ§ª Visa hur man:

- GÃ¶r en GET-fÃ¶rfrÃ¥gan till `/users`

- GÃ¶r en POST-fÃ¶rfrÃ¥gan till `/users` med JSON-body:

  {
    "name": "Lisa",
    "email": "lisa@example.com"
  }

- GÃ¶r en PUT till `/users/:id` med ny data

- GÃ¶r en DELETE till `/users/:id`

-----------------------------
-----------------------------
-----------------------------
ğŸ§‘â€ğŸ’» SJÃ„LVSTÃ„NDIGA Ã–VNINGAR 

-----------------------------
-----------------------------
-----------------------------
ğŸ” Gruppdiskussion:


