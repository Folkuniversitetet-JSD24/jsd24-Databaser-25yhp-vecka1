ğŸš€ Lektionsplanering â€“ Onsdag 14 maj 2025
ğŸ•˜ Tid: 09.00â€“12.00 (3 timmar)
ğŸ¯ Ã„mne: Databasmodellering: one-to-many, many-to-many, relationer, normalisering & avancerade SQL-queries.

-----------------------------
ğŸ¯ Syfte

Efter lektionen ska studenterna kunna:
FÃ¶rstÃ¥ komplexa relationer (one-to-many, many-to-many).

AnvÃ¤nda SQL-transaktioner (BEGIN, COMMIT, ROLLBACK).

UtfÃ¶ra avancerade queries med JOIN, json_agg, GROUP BY

Bygga ett backendflÃ¶de i Express som Ã¤r kopplat till en PostgreSQL-databas

-----------------------------
ğŸ§  Agenda

Intro & mÃ¥lsÃ¤ttning	Vad vi ska uppnÃ¥
ğŸ’» Code-Along â€“ setup-db.js	Modellering + SQL-kod (users, courses, user_courses + indexering)
pgAdmin-visualisering	Verifiera tabeller, relationer & index
ğŸ“¦ CRUD: Users + Courses + Routers	Vi bygger users.js och courses.js
Test & visualisering	Postman, pgAdmin, logik bakom json_agg, responsformat
Gruppdiskussion & reflektion	Se nedan â†’

-----------------------------
-----------------------------
-----------------------------
ğŸ’» Code-Along: Relationshantering & Avancerade SQL-frÃ¥gor

ğŸ—ƒï¸ Databasstruktur (ProjektidÃ©: Kursplattform)
users â†” courses (many-to-many)

Junction-tabell: user_courses

-----------------------------
ğŸ¬ Steg 1 â€“ FÃ¶rberedelser

FÃ¶rbered ett nytt projekt och skapa databas frÃ¥n pgAdmin:

namn: advancedtestdbCA

ğŸ—£ï¸ Talarmanus:

â€Nu bÃ¶rjar vi med att skapa vÃ¥r nya PostgreSQL-databas frÃ¥n pgAdmin.â€

Skapa ett nytt projekt:
npm init -y
npm install express pg dotenv

2ï¸âƒ£ Setup och anslutning till PostgreSQL

Skapa .env-fil:

GenomfÃ¶r den koden

-----------------------------
3ï¸âƒ£ Avancerad SQL-modellering via kod 

ğŸ—£ï¸ Talarmanus:

â€Vi bygger nu en avancerad databasstruktur med one-many och many-to-many relationer. Vi anvÃ¤nder en junction-tabell fÃ¶r att koppla ihop anvÃ¤ndare med kurser i en many-to-many relation.â€

Skapa setup-db.js med tabeller, relationer, transaktioner och index

genomfÃ¶r den koden

KÃ¶r filen i terminalen:
node setup-db.js

Kontrollera visuellt i pgAdmin:
ğŸ“Œ 1. Att alla tabeller Ã¤r skapade

users, courses, user_courses

ğŸ“Œ 2. Att relationerna finns

Klicka pÃ¥ varje tabell â†’ fliken Constraints â†’ du ska se FOREIGN KEYS

ğŸ“Œ 3. Att dina index Ã¤r skapade

Ã–ppna:
Schemas â†’ Tables â†’ users â†’ Indexes
Schemas â†’ Tables â†’ user_courses â†’ Indexes

3B. Avancerad optimering & indexering

ğŸ—£ï¸ Talarmanus:

â€Index gÃ¶r queries snabba. AnvÃ¤nd alltid index fÃ¶r kolumner som anvÃ¤nds ofta i WHERE och JOIN.â€

Skapa index i setup-db.js:
CREATE INDEX idx_user_email ON users(email);
CREATE INDEX idx_user_courses_user_id ON user_courses(user_id);

FÃ¶rklara visuellt i pgAdmin under "Indexes".

ğŸ—£ï¸ Talarmanus:

â€Index Ã¤r som innehÃ¥llsfÃ¶rteckningen i en bok. De gÃ¶r sÃ¶kningar mycket snabbare eftersom databasen inte behÃ¶ver lÃ¤sa igenom hela tabellen. HÃ¤r ser ni de index vi skapat pÃ¥ email och user_id.â€

-----------------------------
 Talarmanus:

â€Nu har vi bÃ¥de relationsstrukturen och optimeringen pÃ¥ plats. Vi gÃ¥r vidare till att bygga det som faktiskt anvÃ¤nder vÃ¥r databas â€“ API:et via Express!â€

4ï¸âƒ£ Skapa index.js + Express server med routing och pool

genomfÃ¶r den koden

"VarfÃ¶r const pool behÃ¶vs bÃ¥de i index.js och setup-db.js?
setup-db.js:
AnvÃ¤nds enbart fÃ¶r att skapa databasen initialt (engÃ¥ngskÃ¶rning). Du avslutar poolen efter kÃ¶rning med pool.end();.

index.js:
KÃ¶rs kontinuerligt fÃ¶r att hantera API-fÃ¶rfrÃ¥gningar. HÃ¤r anvÃ¤nds en egen pool som alltid hÃ¥lls Ã¶ppen.

De behÃ¶ver separata pools fÃ¶r att setup-db.js anvÃ¤nds en gÃ¥ng vid uppsÃ¤ttningen och sedan avslutas, medan index.js Ã¤r igÃ¥ng hela tiden och hanterar HTTP-requests.

-----------------------------
4ï¸âƒ£B. Kompletta CRUD-operationer via Express

skapa router mappen och user.js

genomfÃ¶r den koden.

4C. Koppla routern i index.js

4D.  Skapa routers/courses.js

genomfÃ¶r den koden.

Koppla routern i index.js

-----------------------------
5. UtfÃ¶rlig instruktion fÃ¶r test & visualisering (Postman & pgAdmin):

ğŸ—£ï¸ Talarmanus:

â€Nu testar vi API:et vi byggt. Vi anvÃ¤nder Postman fÃ¶r att skicka requests och pgAdmin fÃ¶r att visuellt kontrollera databasen.â€

FÃ¶rst starta index.js i terminalen:
node --watch index.js

ğŸ§ª Testa med Postman:

POST /courses â†’ skapa ny kurs
POST http://localhost:3000/courses
{
  "title": "Node.js",
  "description": "LÃ¤r dig backendutveckling"
}

och:
{
  "title": "JavaScript",
  "description": "Grunderna i JS"
}

GET /courses â†’ hÃ¤mta alla kurser
GET http://localhost:3000/courses

----------------

POST (skapa anvÃ¤ndare + kurser):
POST http://localhost:3000/users
{
  "name": "Mandus",
  "email": "mandus@example.com",
  "courseIds": [1, 2]
}

och:
{
  "name": "Mandu3333333333s",
  "email": "mand3333333333us@example.com",
  "courseIds": [2, 1]
}

Visa att en anvÃ¤ndare med kurser skapas och returneras.

GET (hÃ¤mta anvÃ¤ndare med kurser):
GET http://localhost:3000/users

BekrÃ¤fta att alla anvÃ¤ndare och deras associerade kurser returneras snyggt i JSON-format.

ğŸ” Visuellt i pgAdmin:

Ã–ppna pgAdmin, navigera till advancedtestdb â†’ hÃ¶gerklicka pÃ¥ tabellen users, user_courses och courses sen vÃ¤lj "View/Edit Data â†’ All rows".

Visa eleverna att data/anvÃ¤ndaren faktiskt skapats. OCH
Att kopplingen skapats korrekt i junction-tabellen (user_courses).

GÃ¶r samma sak fÃ¶r tabellerna courses och user_courses.

FÃ¶rklara kort relationerna och varfÃ¶r junction-tabellen behÃ¶vs fÃ¶r mÃ¥nga-till-mÃ¥nga-relationen.
ğŸ—£ï¸ "HÃ¤r ser vi att anvÃ¤ndaren kopplats till flera kurser via junction-tabellen."

-----------------------------
-----------------------------
-----------------------------
Dags fÃ¶r Ã¶vningar

-----------------------------
-----------------------------
-----------------------------
ğŸ” Gruppdiskussion 

Vad Ã¤r en transaktion och varfÃ¶r anvÃ¤nds BEGIN/COMMIT/ROLLBACK?

Vad Ã¤r fÃ¶rdelen med many-to-many-relationer jÃ¤mfÃ¶rt med one-to-many?

Hur hjÃ¤lper JOIN oss att kombinera data frÃ¥n flera tabeller?

Vilka utmaningar finns med many-to-many relationer?

NÃ¤r Ã¤r det bra att anvÃ¤nda subqueries vs JOINs?